<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Randevular</title>
  <link rel="stylesheet" href="/public/css/admin.css" />
</head>
<body>
  <div class="container">
    <div class="topbar">
      <h1>Randevular</h1>
      <div class="topbar-actions">
        <a href="/admin">Panel</a>
        <a href="/admin/icerik">İçerik</a>
        <a href="/admin/gorseller">Görseller</a>
        <a href="/admin/tema">Renkler</a>
        <a href="/admin/logout">Çıkış</a>
      </div>
    </div>

    <form method="GET" action="/admin/randevular" style="margin-bottom:16px">
      <label>İsim ile ara</label>
      <input name="q" type="text" value="<%= q %>" placeholder="Ad Soyad" />
      <label>Tarih</label>
      <input name="tarih" type="date" value="<%= tarih %>" />
      <button type="submit">Filtrele</button>
    </form>

    <h2>Yeni Randevu Ekle</h2>
    <form method="POST" action="/admin/randevular/yeni">
      <label>Ad Soyad</label>
      <input name="name" required />
      <label>Telefon Numarası</label>
      <input name="phone" required />
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div>
          <label>Tarih</label>
          <input name="date" type="date" />
        </div>
        <div>
          <label>Saat</label>
          <input name="time" type="time" />
        </div>
      </div>
      <label>Notlar</label>
      <textarea name="message" rows="3" placeholder="Notlar"></textarea>
      <button type="submit">Kaydet</button>
    </form>

    <h2 style="margin-top:20px">Kayıtlar</h2>
    <table>
      <thead>
        <tr>
          <th>Ad</th><th>Telefon</th><th>Tarih</th><th>Notlar</th><th>Durum</th><th>İşlemler</th>
        </tr>
      </thead>
      <tbody>
        <% items.forEach(i => { %>
          <tr>
            <td><%= i.name %></td>
            <td><%= i.phone %></td>
            <td><%= i.date ? new Date(i.date).toLocaleString('tr-TR') : '-' %></td>
            <td class="wrap"><%= i.message || '-' %></td>
            <td>
              <form method="POST" action="/admin/randevular/<%= i._id %>/guncelle">
                <select name="status" onchange="this.form.submit()">
                  <option value="pending" <%= i.status==='pending'?'selected':'' %>>Bekliyor</option>
                  <option value="contacted" <%= i.status==='contacted'?'selected':'' %>>Onaylandı</option>
                </select>
              </form>
            </td>
            <td style="display:flex;gap:6px">
              <details>
                <summary>Düzenle</summary>
                <form method="POST" action="/admin/randevular/<%= i._id %>/guncelle" style="margin-top:8px">
                  <label>Ad Soyad</label>
                  <input name="name" value="<%= i.name %>" />
                  <label>Telefon</label>
                  <input name="phone" value="<%= i.phone %>" />
                  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                    <div>
                      <label>Tarih</label>
                      <input name="date" type="date" value="<%= i.date ? new Date(i.date).toISOString().slice(0,10) : '' %>" />
                    </div>
                    <div>
                      <label>Saat</label>
                      <input name="time" type="time" value="<%= i.date ? new Date(i.date).toISOString().slice(11,16) : '' %>" />
                    </div>
                  </div>
                  <label>Notlar</label>
                  <textarea name="message" rows="3"><%= i.message || '' %></textarea>
                  <button type="submit">Kaydet</button>
                </form>
              </details>
              <form method="POST" action="/admin/randevular/<%= i._id %>/onay">
                <button type="submit">Onayla</button>
              </form>
              <form method="POST" action="/admin/randevular/<%= i._id %>/sil" onsubmit="return confirm('Silinsin mi?')">
                <button class="danger" type="submit">Sil</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</body>
</html>
